2001-06-25  Jason R. Mastaler  <jasonrm@nightshade.la.mastaler.com>

	* tmda-filter (envelope_recipient): Use the `X-Originally-To'
	header for the envelope_recipient value if it exists.  
	Patch contributed by Ron Bickers.

	(main): No need to lookup $SENDER a second time.

2001-06-13  Jason R. Mastaler  <jasonrm@nightshade.la.mastaler.com>

	* tmda-filter (main): Lowercase the env sender, From and Reply-to
	before sending them into Util.findmatch because fnmatch does
	case-sensitive comparison on Unix.

2001-06-12  Jason R. Mastaler  <jasonrm@nightshade.la.mastaler.com>

	* tmda-filter (main): Use Util.findmatch instead of
	Util.substring_match.
	
2001-06-08  Jason R. Mastaler  <jasonrm@nightshade.la.mastaler.com>

	* tmda-filter (verify_dated_cookie): Check for the discard
	variable before calling bounce_dated() in all 3 cases.

2001-06-06  Jason R. Mastaler  <jasonrm@nightshade.la.mastaler.com>

	* tmda-filter (bounce_dated): If the template doesn't exist in
	../templates/, we assume installation from an RPM, so look in
	sys.prefix/share/tmda/.

	(bounce_sender): Ditto.
	
2001-06-04  Jason R. Mastaler  <jasonrm@nightshade.la.mastaler.com>

	* tmda-filter (envelope_sender): The envelope sender is used in
	more than one place.

	(send_bounce): Use the popen2 module instead of os.popen to inject
	the message.  This works around an undetermined bug in some BSD
	variants where python hangs after message delivery.

	(bounce_dated): Add the ability to draw the bounce template from
	multiple locations.  Command line takes priority, followed by the
	.tmdarc setting, followed by the default in ../templates/.

	(bounce_sender): Ditto.

	(bounce_dated): Exit ERR_STOP (99) so qmail no longer sends its
	own bounce, but .qmail processing still stops.

	(bounce_sender): Ditto.

	(send_bounce): New function that creates and sends a bounce
	message back to the envelope sender with an 'X-Delivery-Agent'
	header added for easier identification.
	
2001-06-01  Jason R. Mastaler  <jasonrm@nightshade.la.mastaler.com>

	* tmda-inject (main): Fix to make 'QMAILRCPTS' addresses match
	case insensitively.

	* tmda-dated-address (main): Bugfix. When you provide extra
	arguments to tmda-sender-address (e.g. -c /other/.tmdarc), the
	wrong argument is read.

	* tmda-sender-address (main): Ditto.

2001-05-29  Jason R. Mastaler  <jasonrm@nightshade.la.mastaler.com>

	* tmda-keygen (key): Add some integrity checking to make sure
	generated key is the correct length.

	* tmda-filter (main): Add the '-d' option to silently discard the
	message and stop processing of the .qmail file (ERR_STOP) instead
	of bouncing the message back to sender.
	
	* tmda-inject (main): When using TMDA with qfilter, Bcc recipients
	are silently ignored since they aren't in the headers at the time
	qfilter passes the message to tmda-inject.  Fix this by making
	tmda-inject use the QMAILRCPTS environment variable set by qfilter
	when it's available, instead of getting the address list from the
	headers.  This variable will contain a list of envelope
	recipients, which will include any Bcc recipients.

2001-05-28  Jason R. Mastaler  <jason@mastaler.com>

	* tmda-sender-address (main): Bugfix.  When you provide arguments
	to tmda-sender-address (e.g. -c /other/.tmdarc), the address is
	incorrectly read as sys.argv[1] (which would be '-c') and thus
	returns an invalid address.

2001-05-24  Jason R. Mastaler  <jasonrm@nightshade.la.mastaler.com>

	* tmda-inject (qfilter): tmda-inject will exit 99 when run with
	the -q argument so that qmail-qfilter will not run qmail-queue.
	Necessary when running TMDA through a qmail relay.

2001-05-23  Jason R. Mastaler  <jasonrm@nightshade.la.mastaler.com>

	* tmda-filter (main): Add support for "pre-extension" definitions
	in /var/qmail/users/assign.
	
	* tmda-inject (main): Special case files can now contain
	substrings instead of only explicit addresses to match.  To
	support this, exp and ext cases are now stored in lists like the
	other cases instead of dictionaries.  Processing is done with
	Util.findmatch.

2001-05-21  Jason R. Mastaler  <jasonrm@nightshade.la.mastaler.com>

	* tmda-dated-address (main): Support an optional timeout argument
	to override Defaults.TIMEOUT.

2001-05-17  Jason R. Mastaler  <jasonrm@nightshade.la.mastaler.com>

	* tmda-filter (main): Fixed virtualdomain detection to work under
	all cases.

2001-05-13  Jason R. Mastaler  <jasonrm@nightshade.la.mastaler.com>

	* tmda-inject (main): Support `X-TMDA: dated timeout'
	(to override Defaults.TIMEOUT)

2001-05-10  Jason R. Mastaler  <jasonrm@nightshade.la.mastaler.com>

	* tmda-inject (inject_message): Use the popen2 module instead of
	os.popen to work around an undetermined bug in some BSD variants
	where the mutt MUA hangs when sending with tmda-inject.

	(main): Add the platform identifier to X-Delivery-Agent for easier
	diagnosis of platform dependent problems.

2001-05-02  Jason R. Mastaler  <jasonrm@nightshade.acl.lanl.gov>

	* tmda-filter (make_dated_bounce): Depreciated function.
	(make_sender_bounce): Ditto.
	(bounce_dated): Read the bounce message text from a template file
	in ../templates/dated_bounce.txt to ease local customization.
	(bounce_sender): Ditto (bounce_sender.txt).

2001-04-29  Jason R. Mastaler  <jasonrm@nightshade.la.mastaler.com>

	* tmda-filter (program): Add support for alternate rcfile.

	* tmda-inject (program): Ditto.

	* tmda-dated-address: Ditto.

	* tmda-sender-address: Ditto 

	* tmda-filter (main): Add support for qmail virtualdomains as
	described in qmail-send(8).

2001-04-28  Jason R. Mastaler  <jasonrm@nightshade.la.mastaler.com>

	* tmda-inject (main): Changed X-Delivery-Agent to include the
	Python version instead of the TMDA URL.

2001-04-27  Jason R. Mastaler  <jasonrm@nightshade.la.mastaler.com>

	* tmda-keygen (keygen): Replace /dev/random with /dev/urandom;
	/dev/urandom is secure enough for almost any application and saves
	you from blocking.

2001-04-26  Jason R. Mastaler  <jasonrm@nightshade.la.mastaler.com>

	* tmda-filter (verify_dated_cookie): Modified to accommodate the
	new HMAC cookies.

	* tmda-keygen: Remove amkCrypto references.
	(keygen): Collect pseudo-random data from the command-line for key
	material if /dev/random is not available.

2001-04-25  Jason R. Mastaler  <jasonrm@nightshade.la.mastaler.com>

	* tmda-filter : added "mailto:" to the tagged address in the
	bounce message to make it easier to reply to.  Thanks to Paul
	English for the suggestion.

	(bounce_cc): New function to send a copy of a bounced message for
	each of 'blacklist', 'dated', and 'sender'.

	(main): tmda-filter now consults the "whitelist" no matter what
	the destination address is.

2001-04-24  Jason R. Mastaler  <jasonrm@nightshade.la.mastaler.com>

	* tmda-filter (main): changed all references of Whitelist.match()
	to Greylist.match().

