#!/usr/bin/env python

"""Generate a tagged (dated-style) e-mail address.

Usage:  %(program)s [-c <file>] [-h] timeout

Where:
	-c <file>
	--config-file <file>
	   Specify a different configuration file other than ~/.tmdarc.

	--help
	-h
	   Print this help message and exit.

	timeout is an optional timeout interval to override your default.
"""

import getopt
import os
import sys


program = sys.argv[0]

def usage(code, msg=''):
    print __doc__ % globals()
    if msg:
        print msg
    sys.exit(code)

try:
    opts, args = getopt.getopt(sys.argv[1:],
                                   'c:h', ['config-file=','help'])
except getopt.error, msg:
    usage(1, msg)

for opt, arg in opts:
    if opt in ('-h', '--help'):
        usage(0)
    elif opt in ('-c', '--config-file'):
        os.environ['TMDARC'] = arg


import paths
from TMDA import Cookie


def main():

    try:                                # check for timeout override
        os.environ['TMDA_TIMEOUT'] = args[0]
    except IndexError:
        pass
    dated_address = Cookie.make_dated_address()
    sys.stdout.write(dated_address)


if __name__ == '__main__':
    main()
