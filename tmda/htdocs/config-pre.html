<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<!-- THIS PAGE IS AUTOMATICALLY GENERATED.  DO NOT EDIT. -->
<!-- Wed Mar 12 15:01:18 2003 -->
<!-- USING HT2HTML 2.0 -->
<!-- SEE http://ht2html.sf.net -->
<!-- User-specified headers:
Title: TMDA Pre-Configuration

-->

<head>
<title>TMDA Pre-Configuration</title>
<meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
<meta name="generator" content="HT2HTML/2.0">
<style type="text/css">
body { margin: 0px; }
</style>
</head>
<body bgcolor="#ffffff" text="#000000"
      marginwidth="0" marginheight="0"
      link="#0000bb"  vlink="#551a8b"
      alink="#ff0000">
<!-- start of page table -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<!-- start of banner row -->
<tr>
<!-- start of corner cells -->
<td width="150" valign="middle" bgcolor="#afeeee" class="corner">
<center><font size="+2"
        >&gt;&gt;&gt;&nbsp;TMDA&nbsp</font></center> </td>
<td width="15" bgcolor="#cccccc">&nbsp;&nbsp;</td><!--spacer-->
<!-- end of corner cells -->
<!-- start of banner -->
<td width="90%" bgcolor="#cccccc" class="banner">
<!-- start of site links table -->
<table width="100%" border="0"
CELLSPACING=0 CELLPADDING=0
       bgcolor="#ffffff">
<tr>
    <td bgcolor="#cccccc">
<a href="./index.html">TMDA Homepage</a><br>[    <a href="http://www.au.tmda.net/">AU</a> |    <a href="http://www.us.tmda.net/">US</a>     mirror ]
    </td>
    <td bgcolor="#cccccc">
<a href="http://sourceforge.net/projects/tmda">TMDA @ SourceForge</a>
    </td>
    <td bgcolor="#cccccc">
&nbsp;&nbsp;</td>
    <td bgcolor="#cccccc">
&nbsp;&nbsp;</td>
</tr>
</table><!-- end of site links table -->

</td><!-- end of banner -->
</tr><!-- end of banner row -->
<tr><!-- start of sidebar/body row -->
<!-- start of sidebar cells -->
<td width="150" valign="top" bgcolor="#cccccc" class="sidebar">
<!-- start of sidebar table -->
<table width="100%" border="0" cellspacing="0" cellpadding="3"
       bgcolor="#ffffff">
<tr><td bgcolor="#191970"><b><font color="#ffffff">
Overview
</font></b></td></tr>
<tr><td bgcolor="#cccccc">
<a href="index.html">Introduction</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="history.html">History</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="features.html">Features</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="results.html">Results &amp; Testimonials</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="inuse.html">TMDA In Use</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="press.html">Press Coverage</a><!-- -*- html -*- -->
</td></tr>
<tr><td bgcolor="#cccccc">&nbsp;
<tr><td bgcolor="#191970"><b><font color="#ffffff">
Install
</font></b></td></tr>
<tr><td bgcolor="#cccccc">
<a href="requirements.html">Requirements</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="download.html">Download</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="install.html">Installation</a>
</td></tr>
<tr><td bgcolor="#cccccc">&nbsp;
<tr><td bgcolor="#191970"><b><font color="#ffffff">
Configuration
</font></b></td></tr>
<tr><td bgcolor="#cccccc">
<a href="config.html">Overview</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<b>Pre-Configuration</b>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="config-server.html">Server Configuration</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="config-client.html">Client Configuration</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="config-vars.html">Configuration Variables</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="config-filter.html">Filter Specification</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="filter-sources.html">Filter Sources</a>
</td></tr>
<tr><td bgcolor="#cccccc">&nbsp;
<tr><td bgcolor="#191970"><b><font color="#ffffff">
HOWTOs
</font></b></td></tr>
<tr><td bgcolor="#cccccc">
<a href="howtos.html">Overview</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="howto-template.html">Templates</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="tmda-ofmipd.html">tmda-ofmipd</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="tmda-vdomains.html">Virtual Domains</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="tmda-cgi.html">tmda-cgi</a>
</td></tr>
<tr><td bgcolor="#cccccc">&nbsp;
<tr><td bgcolor="#191970"><b><font color="#ffffff">
Support
</font></b></td></tr>
<tr><td bgcolor="#cccccc">
<a href="trouble.html">Troubleshooting</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="http://tmda.net/faq.cgi" TARGET="Resource Window">FAQ</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="bugs.html">Bugs &amp; Patches</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="http://tmda.net/lists/listinfo/" TARGET="Resource Window">Mailing Lists</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="http://mla.libertine.org/" TARGET="Resource Window">List Archive</a> 
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="support-commercial.html">Commercial Support</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="resources.html">External Resources</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="mirrors.html">Mirrors</a>
</td></tr>
<tr><td bgcolor="#cccccc">&nbsp;
<tr><td bgcolor="#191970"><b><font color="#ffffff">
Author
</font></b></td></tr>
<tr><td bgcolor="#cccccc">
<a href="mailto:jason@mastaler.com">Jason R. Mastaler</a>
</td></tr>
<tr><td bgcolor="#cccccc">
&nbsp;
</td></tr>
<tr><td bgcolor="#cccccc">
&copy; 2001-2003
</td></tr>
</table><!-- end of sidebar table -->

</td>
<td width="15">&nbsp;&nbsp;</td><!--spacer-->
<!-- end of sidebar cell -->
<!-- start of body cell -->
<td valign="top" width="90%" class="body"><br>
<h3>TMDA Pre-Configuration</h3>

You may need to make some system-wide configuration changes to your
MTA software depending on which one you are running (in order of ease):
<br><br>

[ <A HREF="#qmail">qmail/Courier</a> | <A HREF="#postfix">Postfix</a> | <A HREF="#exim">Exim</a>  
| <A HREF="#sendmail">Sendmail</a> ]
<br><br>
<hr>

<a name="qmail"><h4>MTA Configuration (qmail and Courier)</h4></a>

No changes need to be made to your configuration in order to use TMDA.
<br><br>
<hr>

<a name="postfix"><h4>MTA Configuration (Postfix)</h4></a>

<ol>

<li>Enable the <strong>recipient_delimiter</strong> parameter in
Postfix's <em>main.cf</em> if it isn't already.  The Postfix default is
<code><b>+</b></code> but <code><b>-</b></code> is an acceptable value as
well.  Just make sure it matches <b>RECIPIENT_DELIMITER</b> in your
<b>tmda/config</b>.

</ol>
<hr>

<a name="exim"><h4>MTA Configuration (Exim)</h4></a>

Edit your Exim run time configuration file as follows:

<h5>MAIN CONFIGURATION</h5>

<ol>
<li>
TMDA uses sendmail's `-f' option to set the envelope sender
address on outgoing messages.  By default this option is only
available to Exim's "trusted users".  You can also add
<b>untrusted_set_sender = true</b> to your Exim configuration
which allows untrusted users use of the -f command line option.
<br><br>

It is recommended that you enable this option or become a
trusted-user, or else the client side of TMDA becomes much less
functional.
<br><br>
</ol>

<h5>DIRECTOR/ROUTER CONFIGURATION</h5>

<ol>

<li>
TMDA is heavily based on user "extension addresses" (e.g,
username+extension@domain.dom), and your Exim must be able
to understand them.  It doesn't by default.  Both
<code><b>+</b></code> and <code><b>-</b></code> are an acceptable
values for the suffix, just make sure it matches
<b>RECIPIENT_DELIMITER</b> in your <b>tmda/config</b>.
<br><br>

Add the following lines to both the <b>userforward</b> and 
the <b>localuser</b> directors if they are not there already:
<br><br>

<blockquote><pre>
suffix = -*
# or "+*" if you prefer "user+suffix" addresses
suffix_optional

</blockquote></pre>

<strong>NOTE:</strong> If you are running Exim version 4.x, 
use <em>local_part_suffix</em>
and <em>local_part_suffix_optional</em> instead.
<br><br>
</ol>

<h5>TRANSPORTS CONFIGURATION</h5>
<ol>

<li>
TMDA receives much of its information about the envelope of
an incoming message from environment variables set by the MTA.  Most
importantly, <strong>SENDER</strong> (the full envelope sender address),
<strong>RECIPIENT</strong> (the full envelope recipient address), and
<strong>EXT</strong> or <strong>EXTENSION</strong> (the recipient
address extension).  Exim currently sets only the first, so you
must set the other two using the <em>environment</em> 
pipe option.<br><br>

<li>
You must also have Exim add a Return-Path: 
header to the message which it doesn't do by default.  Do this
by enabling the <em>return_path_add</em> transport option.
<br><br>

Set <em>return_path_add</em> and <em>environment</em> as follows under
the <strong>address_pipe</strong> transport:
<br><br>

<blockquote><pre>
address_pipe: 
  driver = pipe 
  return_fail_output 
  return_path_add
  environment = EXTENSION=${substr_1:$local_part_suffix}:\
                RECIPIENT=$local_part$local_part_suffix@$domain 
</blockquote></pre>

</ol>

<hr>

<a name="sendmail"><h4>MTA Configuration (Sendmail)</h4></a>

TMDA receives much of its information about the envelope of
an incoming message from environment variables (usually set by the MTA).  Most
importantly, <strong>SENDER</strong> (the full envelope sender address),
<strong>RECIPIENT</strong> (the full envelope recipient address), and
<strong>EXT</strong> or <strong>EXTENSION</strong> (the recipient
address extension).<br><br>

The main difficulty with using TMDA under Sendmail, is that Sendmail does
not provide such variables as the other three supported MTAs do.
In fact, it does not provide any envelope information to commands run
from a .forward file.  In order to be reliable, TMDA needs these
<em>real</em> sender and recipient values.  It can't rely on what
might be in the To: or From: headers.<br><br>

So in order to use TMDA, you need some way to obtain the necessary
envelope information and set the above mentioned environment
variables.  It matters not how you do this, just as long as these
variables are properly set by the time TMDA sees the message.  TMDA
expects these variables to be in the following format:

<blockquote><pre>
SENDER=sender@domain.dom
RECIPIENT=recipient@domain.dom
EXTENSION=foo
</blockquote></pre>

That is, just the e-mail address or recipient address extension, with no
trailing or leading whitespace, or any other extraneous characters.
<br><br>

If your Sendmail installation is using <a
href="http://www.procmail.org/" TARGET="Resource Window">procmail</a>
as its local mailer, the necessary information is passed as a command
line argument to procmail, typically introduced by the "-a" flag.
Your <b>.procmailrc</b> will then be able to construct the environment
variables from this argument.  The necessary Sendmail configuration
changes are covered below, and a sample .procmailrc is given in the
next section.  <br><br>
<ol>

<li>Make sure procmail is installed on your server, and then add the
following rule to your <b>sendmail.mc</b> file if it is not
already present (most Linux distributions already define this!):
<br><br>

<blockquote><pre>
FEATURE(`local_procmail', `/usr/bin/procmail')

</blockquote></pre>

<li>Now run <b>sendmail.mc</b> through <b>m4</b> to produce your new
<b>sendmail.cf</b> file, and restart Sendmail so the changes will take
effect.

</ol>

<hr>
</td><!-- end of body cell -->
</tr><!-- end of sidebar/body row -->
</table><!-- end of page table -->
</body></html>
