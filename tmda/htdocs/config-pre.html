<HTML>
<!-- THIS PAGE IS AUTOMATICALLY GENERATED.  DO NOT EDIT. -->
<!-- Fri Dec 14 19:51:47 2001 -->
<!-- USING HT2HTML 1.2 -->
<!-- SEE http://barry.wooz.org/software/ht2html -->
<!-- User-specified headers:
Title: TMDA Pre-Configuration

-->

<HEAD>
<TITLE>TMDA Pre-Configuration</TITLE>

</HEAD>
<BODY BGCOLOR="#ffffff" TEXT="#000000"
      TOPMARGIN="0" LEFTMARGIN="0" MARGINWIDTH="0" MARGINHEIGHT="0"
      LINK="#0000bb"  VLINK="#551a8b"
      ALINK="#ff0000">
<!-- start of page table -->
<TABLE WIDTH="100%" BORDER=0 CELLSPACING=0 CELLPADDING=0>
<!-- start of banner row -->
<TR>
<!-- start of corner cells -->
<TD WIDTH=150 VALIGN=CENTER BGCOLOR="#191970">

        <font color="#191970">
        <h3> T M D A </h3>
        </font> </TD>
<TD WIDTH=15 BGCOLOR="#cccccc">&nbsp;&nbsp;</TD><!--spacer-->
<!-- end of corner cells -->
<!-- start of banner -->
<TD WIDTH="90%" BGCOLOR="#cccccc">
<!-- start of site links table -->
<TABLE WIDTH="100%" BORDER=0
CELLSPACING=0 CELLPADDING=0
       COLS=4 ROWS=1 BGCOLOR="#ffffff">
<TR>
    <TD BGCOLOR="#cccccc">
<a href="./index.html">TMDA Homepage</a>
    </TD>
    <TD BGCOLOR="#cccccc">
<a href="http://sourceforge.net/projects/tmda">TMDA @ SourceForge</a>
    </TD>
    <TD BGCOLOR="#cccccc">
&nbsp;&nbsp;</TD>
    <TD BGCOLOR="#cccccc">
&nbsp;&nbsp;</TD>
</TR>
</TABLE><!-- end of site links table -->

</TD><!-- end of banner -->
</TR><!-- end of banner row -->
<TR><!-- start of sidebar/body row -->
<!-- start of sidebar cells -->
<TD WIDTH=150 VALIGN=TOP BGCOLOR="#cccccc">
<!-- start of sidebar table -->
<TABLE WIDTH="100%" BORDER=0 CELLSPACING=0 CELLPADDING=3
       BGCOLOR="#ffffff">
<TR><TD BGCOLOR="#191970"><B><FONT COLOR="#ffffff">
Overview
</FONT></B></TD></TR>
<TR><TD BGCOLOR="#cccccc">
<A HREF="index.html">Introduction</A>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">
<A HREF="history.html">History</A>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">
<A HREF="features.html">Features</A>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">
<A HREF="results.html">Results &amp; Testimonials</A>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">
<A HREF="inuse.html">TMDA In Use</A>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">&nbsp;
<TR><TD BGCOLOR="#191970"><B><FONT COLOR="#ffffff">
Usage
</FONT></B></TD></TR>
<TR><TD BGCOLOR="#cccccc">
<A HREF="requirements.html">Requirements</A>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">
<A HREF="download.html">Download</A>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">
<A HREF="install.html">Installation</A>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">
<A HREF="config.html">Configuration</A>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">&nbsp;
<TR><TD BGCOLOR="#191970"><B><FONT COLOR="#ffffff">
Configuration
</FONT></B></TD></TR>
<TR><TD BGCOLOR="#cccccc">
<A HREF="config.html">Overview</A>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">
<b>Pre-Configuration</b>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">
<A HREF="config-server.html">Server Configuration</A>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">
<A HREF="config-client.html">Client Configuration</A>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">
<A HREF="config-filter.html">Filter Specification</A>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">&nbsp;
<TR><TD BGCOLOR="#191970"><B><FONT COLOR="#ffffff">
Support
</FONT></B></TD></TR>
<TR><TD BGCOLOR="#cccccc">
<A HREF="faq.html">FAQ</A>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">
<A HREF="lists.html">Mailing Lists</A>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">
<A HREF="bugs.html">Bugs &amp; Patches</A>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">
<A HREF="resources.html">External Resources</A>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">&nbsp;
<TR><TD BGCOLOR="#191970"><B><FONT COLOR="#ffffff">
Author
</FONT></B></TD></TR>
<TR><TD BGCOLOR="#cccccc">
<A HREF="mailto:jason@mastaler.com">Jason R. Mastaler</A>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">
&nbsp;
</TD></TR>
<TR><TD BGCOLOR="#cccccc">
&copy; 2001
</TD></TR>
</TABLE><!-- end of sidebar table -->

</TD>
<TD WIDTH=15>&nbsp;&nbsp;</TD><!--spacer-->
<!-- end of sidebar cell -->
<!-- start of body cell -->
<TD VALIGN=TOP WIDTH="90%"><BR>
<h3>TMDA Pre-Configuration</h3>

You may need to make some system-wide configuration changes to your
MTA software depending on which one you are running (in order of ease):
<br><br>

[ <A HREF="#qmail">qmail</a> | <A HREF="#postfix">Postfix</a> | <A HREF="#exim">Exim</a>  
| <A HREF="#sendmail">Sendmail</a> ]
<br><br>
<hr>

<a name="qmaill"><h4>MTA Configuration (qmail)</h4></a>

No changes need to be made to your qmail configuration in order to use TMDA.
<br><br>
<hr>

<a name="postfix"><h4>MTA Configuration (Postfix)</h4></a>

<ol>

<li>Enable the <strong>recipient_delimiter</strong> parameter in
Postfix's <em>main.cf</em> if it isn't already.  The Postfix default is
<code><b>+</b></code> but <code><b>-</b></code> is an acceptable value as
well.  Just make sure it matches <b>RECIPIENT_DELIMITER</b> in your
<b>tmdarc</b>.

</ol>
<hr>

<a name="exim"><h4>MTA Configuration (Exim)</h4></a>

Edit your Exim run time configuration file as follows:

<h5>MAIN CONFIGURATION</h5>

<ol>
<li>
TMDA uses sendmail's `-f' option to set the envelope sender
address on outgoing messages.  By default this option is only
available to Exim's "trusted users".  You can also add
<b>untrusted_set_sender = true</b> to your Exim configuration
which allows untrusted users use of the -f command line option.
<br><br>

It is recommended that you enable this option or become a
trusted-user, or else the client side of TMDA becomes much less
functional.
<br><br>
</ol>

<h5>DIRECTORS CONFIGURATION</h5>

<ol>

<li>
TMDA is heavily based on user "extension addresses" (e.g,
username+extension@domain.dom), and your Exim must be able
to understand them.  It doesn't by default.  Both
<code><b>+</b></code> and <code><b>-</b></code> are an acceptable
values for the suffix, just make sure it matches
<b>RECIPIENT_DELIMITER</b> in your <b>tmdarc</b>.
<br><br>

Add the following two lines to both the <b>userforward</b> and 
the <b>localuser</b> directors if they are not there already:
<br><br>

<blockquote><pre>
suffix = -*     # or "+*" if you prefer "user+suffix" addresses
suffix_optional
</blockquote></pre>

</ol>

<h5>TRANSPORTS CONFIGURATION</h5>
<ol>

<li>
TMDA receives much of its information about the envelope of
an incoming message from environment variables set by the MTA.  Most
importantly, <strong>SENDER</strong> (the full envelope sender address),
<strong>RECIPIENT</strong> (the full envelope recipient address), and
<strong>EXT</strong> or <strong>EXTENSION</strong> (the recipient
address extension).  Exim currently sets only the first, so you
must set the other two using the <em>environment</em> 
pipe option.
<br><br>

Set <em>environment</em> as follows under the
<strong>address_pipe</strong> transport:
<br><br>

<blockquote><pre>
address_pipe: 
  driver = pipe 
  return_fail_output 
  environment = EXTENSION=${substr_1:$local_part_suffix}:\
                RECIPIENT=$local_part$local_part_suffix@$domain 
</blockquote></pre>

</ol>

<hr>

<a name="sendmail"><h4>MTA Configuration (Sendmail)</h4></a>

TMDA receives much of its information about the envelope of
an incoming message from environment variables (usually set by the MTA).  Most
importantly, <strong>SENDER</strong> (the full envelope sender address),
<strong>RECIPIENT</strong> (the full envelope recipient address), and
<strong>EXT</strong> or <strong>EXTENSION</strong> (the recipient
address extension).<br><br>

The main difficulty with using TMDA under Sendmail, is that Sendmail does
not provide such variables as the other three supported MTAs do.
In fact, it does not provide any envelope information to commands run
from a .forward file.  In order to be reliable, TMDA needs these
<em>real</em> sender and recipient values.  It can't rely on what
might be in the To: or From: headers.<br><br>

So in order to use TMDA, you need some way to obtain the necessary
envelope information and set the corresponding environment variables.
If your Sendmail installation is using <a
href="http://www.procmail.org/" TARGET="Resource Window">procmail</a>
as its local mailer, you can do this by configuring Sendmail to add
the envelope information as headers in the message.  Your
<b>.procmailrc</b> can then set the environment variables from these
headers.  The necessary Sendmail configuration changes are
covered below.  <br><br>

<ol>

<li>Make sure procmail is installed on your server, and then add the
following rules to your <b>sendmail.mc</b> file if they are not
already present: <br><br>

<blockquote><pre>
FEATURE(`local_procmail', `/usr/bin/procmail')

LOCAL_CONFIG
HX-Envelope-To: $u 
HX-Envelope-From: $g 
</blockquote></pre>

Sendmail will now use procmail to delivery local mail, and will
add `X-Envelope-To' and `X-Envelope-From' headers to every 
message it handles.
<br><br>

<li>Now run <b>sendmail.mc</b> through <b>m4</b> to produce your new
<b>sendmail.cf</b> file, and restart Sendmail so the changes will take
effect.

</ol>

<hr>
</TD><!-- end of body cell -->
</TR><!-- end of sidebar/body row -->
</TABLE><!-- end of page table -->
</BODY></HTML>
