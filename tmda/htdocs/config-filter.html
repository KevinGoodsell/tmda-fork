<HTML>
<!-- THIS PAGE IS AUTOMATICALLY GENERATED.  DO NOT EDIT. -->
<!-- Sun Dec  2 20:16:06 2001 -->
<!-- USING HT2HTML 1.2 -->
<!-- SEE http://barry.wooz.org/software/ht2html -->
<!-- User-specified headers:
Title: TMDA Filter Specification

-->

<HEAD>
<TITLE>TMDA Filter Specification</TITLE>

</HEAD>
<BODY BGCOLOR="#ffffff" TEXT="#000000"
      TOPMARGIN="0" LEFTMARGIN="0" MARGINWIDTH="0" MARGINHEIGHT="0"
      LINK="#0000bb"  VLINK="#551a8b"
      ALINK="#ff0000">
<!-- start of page table -->
<TABLE WIDTH="100%" BORDER=0 CELLSPACING=0 CELLPADDING=0>
<!-- start of banner row -->
<TR>
<!-- start of corner cells -->
<TD WIDTH=150 VALIGN=CENTER BGCOLOR="#191970">

        <font color="#191970">
        <h3> T M D A </h3>
        </font> </TD>
<TD WIDTH=15 BGCOLOR="#cccccc">&nbsp;&nbsp;</TD><!--spacer-->
<!-- end of corner cells -->
<!-- start of banner -->
<TD WIDTH="90%" BGCOLOR="#cccccc">
<!-- start of site links table -->
<TABLE WIDTH="100%" BORDER=0
CELLSPACING=0 CELLPADDING=0
       COLS=4 ROWS=1 BGCOLOR="#ffffff">
<TR>
    <TD BGCOLOR="#cccccc">
<a href="./index.html">TMDA Homepage</a>
    </TD>
    <TD BGCOLOR="#cccccc">
<a href="http://sourceforge.net/projects/tmda">TMDA @ SourceForge</a>
    </TD>
    <TD BGCOLOR="#cccccc">
&nbsp;&nbsp;</TD>
    <TD BGCOLOR="#cccccc">
&nbsp;&nbsp;</TD>
</TR>
</TABLE><!-- end of site links table -->

</TD><!-- end of banner -->
</TR><!-- end of banner row -->
<TR><!-- start of sidebar/body row -->
<!-- start of sidebar cells -->
<TD WIDTH=150 VALIGN=TOP BGCOLOR="#cccccc">
<!-- start of sidebar table -->
<TABLE WIDTH="100%" BORDER=0 CELLSPACING=0 CELLPADDING=3
       BGCOLOR="#ffffff">
<TR><TD BGCOLOR="#191970"><B><FONT COLOR="#ffffff">
Overview
</FONT></B></TD></TR>
<TR><TD BGCOLOR="#cccccc">
<A HREF="index.html">Introduction</A>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">
<A HREF="history.html">History</A>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">
<A HREF="features.html">Features</A>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">
<A HREF="results.html">Results &amp; Testimonials</A>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">
<A HREF="inuse.html">TMDA In Use</A>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">&nbsp;
<TR><TD BGCOLOR="#191970"><B><FONT COLOR="#ffffff">
Usage
</FONT></B></TD></TR>
<TR><TD BGCOLOR="#cccccc">
<A HREF="requirements.html">Requirements</A>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">
<A HREF="download.html">Download</A>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">
<A HREF="install.html">Installation</A>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">
<A HREF="config.html">Configuration</A>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">&nbsp;
<TR><TD BGCOLOR="#191970"><B><FONT COLOR="#ffffff">
Configuration
</FONT></B></TD></TR>
<TR><TD BGCOLOR="#cccccc">
<A HREF="config.html">Overview</A>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">
<A HREF="config-pre.html">Pre-Configuration</A>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">
<A HREF="config-server.html">Server Configuration</A>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">
<A HREF="config-client.html">Client Configuration</A>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">
<b>Filter Specification</b>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">&nbsp;
<TR><TD BGCOLOR="#191970"><B><FONT COLOR="#ffffff">
Support
</FONT></B></TD></TR>
<TR><TD BGCOLOR="#cccccc">
<A HREF="faq.html">FAQ</A>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">
<A HREF="lists.html">Mailing Lists</A>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">
<A HREF="bugs.html">Bugs &amp; Patches</A>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">
<A HREF="resources.html">External Resources</A>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">&nbsp;
<TR><TD BGCOLOR="#191970"><B><FONT COLOR="#ffffff">
Author
</FONT></B></TD></TR>
<TR><TD BGCOLOR="#cccccc">
<A HREF="mailto:jason@mastaler.com">Jason R. Mastaler</A>
</TD></TR>
<TR><TD BGCOLOR="#cccccc">
&nbsp;
</TD></TR>
<TR><TD BGCOLOR="#cccccc">
&copy; 2001
</TD></TR>
</TABLE><!-- end of sidebar table -->

</TD>
<TD WIDTH=15>&nbsp;&nbsp;</TD><!--spacer-->
<!-- end of sidebar cell -->
<!-- start of body cell -->
<TD VALIGN=TOP WIDTH="90%"><BR>
<h3>TMDA Filter Specification</h3>

TMDA filter files are used to control mail both coming in to and going
out of TMDA.  For incoming, the filter controls how the message is
disposed of.  For outgoing, it controls how the message is tagged.
The incoming filter file default is <b>~/.tmda/filters/incoming</b>,
which can be changed by setting <b>FILTER_INCOMING</b> in your
<b>tmdarc</b>.  The outgoing filter file default is
<b>~/.tmda/filters/outgoing</b>, which can be changed by setting
<b>FILTER_OUTGOING</b>.  
<br><br>

<u><b>Format of Filter Files</u></b>:
<br><br>

Each line of a filter file is expected to be a string containing three
unquoted fields separated by whitespace.  Everything after
<code><b>#</b></code> on a line is considered a comment and ignored.
Blank lines and lines with invalid syntax are also ignored:
Lines are read sequentially from top to bottom, and the first match
wins.  The three fields are:
<br>

<blockquote><pre><b>
source match action

</blockquote></pre></b>

<li><b>source</b>: specifices the source of the match and can be one of:
<br><br>

(for both incoming and outgoing):
<blockquote><pre>
to (recipient address)
to-file
to-cdb
to-dbm

</blockquote></pre>

(for incoming only):
<blockquote><pre>
from (sender address)
from-file
from-cdb
from-dbm
body (message body)
body-file
headers (message headers)
headers-file
size (message size)

</blockquote></pre>

<li><b>match</b>: 
should be an expression, or the full path to a textfile, CDB database, or
DBM database containing more expressions if <b>source</b> was suffixed
with `-file', `-cdb', or `-dbm'.
<br><br>

The second field within a textfile, CDB or DBM is optional, but overrides
action if present.  e.g,

<blockquote><pre>
foo@mastaler.com
bar@mastaler.com bounce

</blockquote></pre>
In a CDB or DBM, the keys should be the e-mail addresses to match, and
their corresponding values (or records) should be empty unless you
want to override the action specified in the filter file.  Example
scripts are included in the <strong>contrib</strong> directory to
convert your TMDA-style lists into CDB/DBM files and vice-versa.
These are <em>list2cdb/list2dbm</em> and <em>printcdb/printdbm</em>.
For CDB, you can also use the utilities (cdbmake, cdbdump, etc.) from
DJB's <a href="http://cr.yp.to/cdb.html" TARGET="Resource Window">CDB distribution</a> 
if you prefer.

DBM support comes with your Python intrepreter, but CDB support
currently requires that you first install the
<a href="http://pilcrow.madison.wi.us/" TARGET="Resource Window">python-cdb</a>
extension module.  Also see
<a href="http://mla.libertine.org/tmda-workers/200111/msg00181.html" TARGET="Resource Window">
this message</a> for more on installing python-cdb.  
<br><br>

The following table shows what the <b>match</b> expression should
contain for a given <b>source</b>:
<br><br>

<blockquote><pre>
source:		match:
-------		------
to*		recipient e-mail address or wildcard expression.
from*		sender e-mail address or wildcard expression.
body*		regular expression matching message body content.
headers*	regular expression matching message header content.
size		comparison operator and number of bytes to compare to the
		size of the message.  Only `<' and `>' are supported.

</blockquote></pre>
<strong>NOTE:</strong> To match the empty envelope sender such as bounce
messages are sent with, use <b><code><></code></b> as the expression.
<br><br>

In addition to explicit e-mail addresses, you can use expressions
based on UNIX shell-style wildcard characters in either the
<b>match</b> field of a line, or within the textfile in the
<b>match</b> field.  Wildcard characters are not recognized
in a CDB or DBM file.  The special characters are:

<blockquote><pre>

Characters(s)    Description
-------------    -----------
*                Matches everything.
?                Matches any single character.
[seq]            Matches any character in seq.
[!seq]           Matches any character not in seq.

</blockquote></pre>

In addition, <code>`@='</code> (a custom rule) will expand to match
both <code>@</code> and <code>@*.</code>
<br><br>

Here are some common examples:
<blockquote><pre>   
# match only jdoe@domain.dom
jdoe@domain.dom
# match anyone@domain.dom, but not anyone@sub.domain.dom
*@domain.dom 
# match anyone@sub.domain.dom, but not anyone@domain.dom
*@*.domain.dom
# match both anyone@domain.dom, and anyone@sub.domain.dom
*@=domain.dom   

</blockquote></pre>

<li><b>action</b>: 
action specifies what action to take on the message.  An optional
<code><b>=</b></code> separates the action from the action's option.
Possible values differ based on whether the message is incoming or
outgoing.
<br><br>

(for incoming, action can be one of):
<blockquote><pre>
bounce,reject (bounce the message)
drop,exit,stop (silently drop the message)
ok,accept,deliver (deliver the message)
confirm (request confirmation for the message)

</blockquote></pre>

(for outgoing, action can be one of):
<blockquote><pre>
bare (don't tag)
bare=append (don't tag, and also add recipient to your BARE_APPEND file)
sender (tag with a sender address based on recipient)
sender=address (tag with a sender address based on address instead)
dated (tag with a dated address)
dated=timeout_interval 
exp,explicit,as=full_address (use an explicit address)
ext,extension=address_extension (add an extension to the address)
kw,keyword=keyword (tag with a keyword address)

</blockquote></pre>

<u><b>Example Incoming Filter</u></b>:

<pre>

### ~/.tmda/filters/incoming (first match wins) ###

# Accept all bounces (messages with an empty envelope sender)
from <> ok

# Accept all messages to postmistress
to postmistress@* accept

# Bounce all messages from badboy.dom
from *@=badboy.dom bounce

# Accept all messages from mycorp.dom
from *@=mycorp.dom ok

# Include my blacklist and whitelist
from-dbm ~/.tmda/lists/blacklist.db drop
from-cdb ~/.tmda/lists/whitelist.cdb accept
from-file ~/.tmda/lists/whitelist_wildcards accept

# Revoked addresses
to jason-stupid-promo.289076@mastaler.com bounce
to jason-jcrew.832234@mastaler.com confirm

# Examine the message content
body (viagra|ginseng) confirm
headers (Precedence:.*junk) reject

# Accept all messages smaller than 10KB, but drop messages larger than 1MB
size <10000 deliver
size >1000000 exit

</pre>

<u><b>Example Outgoing Filter</u></b>:
<pre>

#### ~/.tmda/filters/outgoing (first match wins) ###

# All whitelisted contacts receive untagged messages
to-cdb ~/.tmda/lists/whitelist.cdb bare
to-file ~/.tmda/lists/whitelist_wildcards bare

# Keyword Addresses
to *@myisp.net kw=myisp
to king@grassland.com keyword=elvis_parsley

# Dated addresses (some with a non-default timeout interval)
to bobby@peru.com dated
to-dbm /var/dbm/slowpokes.db dated=6M

# Several ways of handling subscriber-only mailing lists
to *postfix-users*@postfix.org keyword=postfix-users
to exim-users@exim.org extension=mlist-exim-users
to-file ~/.lists ext=mlists
to owner-python-crypto@nic.surfnet.nl sender
to python-crypto@* sender=owner-python-crypto@nic.surfnet.nl

# Use a different username and/or domain
to *@gnus.org exp=jason@gnus.org
to xemacs-binary-kits* explicit=binkit-manager@XEmacs.ORG
to *mail*@=xemacs.org as=postmaster@XEmacs.ORG
to *@=xemacs.org as=jasonrm@xemacs.org

</pre>

</TD><!-- end of body cell -->
</TR><!-- end of sidebar/body row -->
</TABLE><!-- end of page table -->
</BODY></HTML>
