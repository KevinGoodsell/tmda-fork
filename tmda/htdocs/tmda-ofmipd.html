<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<!-- THIS PAGE IS AUTOMATICALLY GENERATED.  DO NOT EDIT. -->
<!-- Thu Jul  3 14:34:22 2003 -->
<!-- USING HT2HTML 2.0 -->
<!-- SEE http://ht2html.sf.net -->
<!-- User-specified headers:
Title: tmda-ofmipd HOWTO

-->

<head>
<title>tmda-ofmipd HOWTO</title>
<meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
<meta name="generator" content="HT2HTML/2.0">
<style type="text/css">
body { margin: 0px; }
</style>
</head>
<body bgcolor="#ffffff" text="#000000"
      marginwidth="0" marginheight="0"
      link="#0000bb"  vlink="#551a8b"
      alink="#ff0000">
<!-- start of page table -->
<table width="100%" border="0" cellspacing="0" cellpadding="0">
<!-- start of banner row -->
<tr>
<!-- start of corner cells -->
<td width="150" valign="middle" bgcolor="#afeeee" class="corner">
<center><font size="+2"
        >&gt;&gt;&gt;&nbsp;TMDA&nbsp</font></center> </td>
<td width="15" bgcolor="#cccccc">&nbsp;&nbsp;</td><!--spacer-->
<!-- end of corner cells -->
<!-- start of banner -->
<td width="90%" bgcolor="#cccccc" class="banner">
<!-- start of site links table -->
<table width="100%" border="0"
CELLSPACING=0 CELLPADDING=0
       bgcolor="#ffffff">
<tr>
    <td bgcolor="#cccccc">
<a href="./index.html">TMDA Homepage</a><br>[    <a href="http://www.au.tmda.net/">AU</a> |    <a href="http://www.us.tmda.net/">US</a>     mirror ]
    </td>
    <td bgcolor="#cccccc">
<a href="./tmda-cgi">tmda-cgi</a>
    </td>
    <td bgcolor="#cccccc">
<a href="http://sourceforge.net/projects/tmda">TMDA @ SourceForge</a>
    </td>
    <td bgcolor="#cccccc">
&nbsp;&nbsp;</td>
</tr>
</table><!-- end of site links table -->

</td><!-- end of banner -->
</tr><!-- end of banner row -->
<tr><!-- start of sidebar/body row -->
<!-- start of sidebar cells -->
<td width="150" valign="top" bgcolor="#cccccc" class="sidebar">
<!-- start of sidebar table -->
<table width="100%" border="0" cellspacing="0" cellpadding="3"
       bgcolor="#ffffff">
<tr><td bgcolor="#191970"><b><font color="#ffffff">
Overview
</font></b></td></tr>
<tr><td bgcolor="#cccccc">
<a href="index.html">Introduction</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="history.html">History</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="features.html">Features</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="results.html">Results &amp; Testimonials</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="inuse.html">TMDA In Use</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="press.html">Press Coverage</a><!-- -*- html -*- -->
</td></tr>
<tr><td bgcolor="#cccccc">&nbsp;
<tr><td bgcolor="#191970"><b><font color="#ffffff">
Install
</font></b></td></tr>
<tr><td bgcolor="#cccccc">
<a href="requirements.html">Requirements</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="download.html">Download</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="install.html">Installation</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="upgrade.html">Upgrading</a>
</td></tr>
<tr><td bgcolor="#cccccc">&nbsp;
<tr><td bgcolor="#191970"><b><font color="#ffffff">
Configuration
</font></b></td></tr>
<tr><td bgcolor="#cccccc">
<a href="config.html">Overview</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="config-pre.html">Pre-Configuration</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="config-server.html">Server Configuration</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="config-client.html">Client Configuration</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="config-vars.html">Configuration Variables</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="config-filter.html">Filter Specification</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="filter-sources.html">Filter Sources</a>
</td></tr>
<tr><td bgcolor="#cccccc">&nbsp;
<tr><td bgcolor="#191970"><b><font color="#ffffff">
HOWTOs
</font></b></td></tr>
<tr><td bgcolor="#cccccc">
<a href="howtos.html">Overview</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="howto-template.html">Templates</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<b>tmda-ofmipd</b>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="tmda-vdomains.html">Virtual Domains</a>
</td></tr>
<tr><td bgcolor="#cccccc">&nbsp;
<tr><td bgcolor="#191970"><b><font color="#ffffff">
Support
</font></b></td></tr>
<tr><td bgcolor="#cccccc">
<a href="trouble.html">Troubleshooting</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="http://tmda.net/faq.cgi" TARGET="Resource Window">FAQ</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="bugs.html">Bugs &amp; Patches</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="http://tmda.net/lists/listinfo/" TARGET="Resource Window">Mailing Lists</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="http://mla.libertine.org/" TARGET="Resource Window">List Archive</a> 
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="support-commercial.html">Commercial Support</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="resources.html">External Resources</a>
</td></tr>
<tr><td bgcolor="#cccccc">
<a href="mirrors.html">Mirrors</a>
</td></tr>
<tr><td bgcolor="#cccccc">&nbsp;
<tr><td bgcolor="#191970"><b><font color="#ffffff">
Author
</font></b></td></tr>
<tr><td bgcolor="#cccccc">
<a href="mailto:jason@mastaler.com">Jason R. Mastaler</a>
</td></tr>
<tr><td bgcolor="#cccccc">
&nbsp;
</td></tr>
<tr><td bgcolor="#cccccc">
&copy; 2001-2003
</td></tr>
</table><!-- end of sidebar table -->

</td>
<td width="15">&nbsp;&nbsp;</td><!--spacer-->
<!-- end of sidebar cell -->
<!-- start of body cell -->
<td valign="top" width="90%" class="body"><br>
<h1>tmda-ofmipd</h1>

<hr>

<h2>What is it&nbsp;?</h2>
tmda-ofmipd is an async I/O based authenticated 

<a href="http://cr.yp.to/proto/ofmip.html" TARGET="Resource Window">ofmip</a>

proxy for TMDA.  This allows users of any mail client capable of SMTP
Authentication (e.g, Outlook, Eudora, Mozilla) to "tag" their outgoing
mail as described in the

<a href="config-client.html">Client Configuration</a>

section.  
<br><br>
tmda-ofmipd does this by listening on an available port (e.g, 8025),
accepting SMTP connections to that port, and then "tagging" the
message according to the TMDA configuration of the authenticated user.
<br><br>

I call it a proxy because it's not replacing the real SMTP server.  It
only accepts the message from the client, transforms the headers, and
then sends the message by handing it off to the real SMTP server.
<br><br>

There are several reasons why you may want (or have to) use tmda-ofmipd to
take advantage of TMDA's client features:<br>

<ul>

<li>Your mail client (MUA) doesn't support a /usr/sbin/sendmail interface, but
rather uses direct SMTP to send mail.  This includes practically all non-Unix
mail clients, and even some Unix clients such as Mozilla.<br><br>

<li>You want to maintain your TMDA configuration in one central
location instead of on your workstation and your mail server.  Unless
the two share a home directory via NFS or somesuch, this isn't
trivial.  tmda-ofmipd allows you to maintain only one set of files (on
the server).
</ul>

<hr>

<h2>Requirements</h2>

<ul>

<li>Python 2.2 or greater.  tmda-ofmipd uses some essential features
that were introduced in the 2.2 release.  If your Python is older than
this, please 

<a href="http://python.org/download/" TARGET="Resource Window">upgrade</a>.
<br><br>

<li>An MUA that supports RFC 2554 SMTP Authentication (i.e, username/password).
TMDA <a href="http://tmda.net/faq.cgi?req=all#5.6">FAQ 5.6</a> contains a 
preliminary list of MUAs known to work with tmda-ofmipd.<br><br>
NOTE: If your MUA only supports a sendmail command-line interface, but you still
want to use tmda-ofmipd, see below for some options.

</ul>

<hr>

<h2>Authentication</h2>

tmda-ofmipd implements the minimal SMTP protocol as defined in RFC
2821, the ESMTP EHLO command defined in RFC 1869, and SMTP
Authentication (PLAIN, LOGIN, CRAM-MD5 methods) as defined in RFC
2554.  The proxy <strong>cannot</strong> be used by an unauthenticated user.

<h4>Authentication Sources</h4>
tmda-ofmipd can get its authentication information from several different sources.
<ol>

<li>From a "password"
file that you create.  The format of this file is simple.  Each line
of the file should contain a username and password separated by a
colon; one entry per line.  e.g,

<pre><blockquote>
bobby:FooBar
chloe:baz_bap
johndoe:8i9/hjuy+33

</pre></blockquote>

The username fields should match the usernames of the TMDA users on your mail
server.<br><br>

The passwords need not be the same as any other passwords on the system.
In fact, for security reasons, they should remain distinct!
<br><br>

The default location for the authentication file /etc/tofmipd if
running in global mode (see below), otherwise ~user/.tmda/tofmipd.
These defaults can be overridden using tmda-ofmipd's `-a' flag.
<br><br>

The authentication file must be chmod 600 or 400, and be owned by the
user running the daemon.  tmda-ofmipd will fail to start otherwise.
<br><br>

<li>
A checkpassword compatible programs such as 
<a href="http://checkpasswd-pam.sourceforge.net/" TARGET="Resource Window">checkpassword-pam</a>.
This would allow you to utilize your existing password database.
Use tmda-ofmipd's `-A' flag to specify the program and arguments.  The help output
contains such an example.
<br><br>

<li>Against a remote resource such as POP3, IMAP, or LDAP server.
Use tmda-ofmipd's `-R' flag to specify the protocol, and optionally
the hostname and port of the server.  See the help output for supported
protocols and example usage.

</ol>
<hr>

<h2>Running</h2>

Familiarize yourself with tmda-ofmipd's command-line options by reading
the output of:

<blockquote><code>
tmda-ofmipd --help

</blockquote></code>

tmda-ofmipd can be run in two modes.  "Personal" by your
non-privileged TMDA user account for your own personal use, or
"Global" by your system administrator to serve multiple TMDA users on the
system with once instance of the daemon.

<h4>Personal mode</h4>
<ol>
<li>Create an authentication file as described above in ~/.tmda/tofmipd.
</ol>

<h4>Global mode</h4>
<ol>
<li>Create an authentication file as described above in /etc/tofmipd.
<br><br>

<li>Create a non-priveleged user account for tmda-ofmipd to run under.  The
following creates an account for user `tofmipd', group `tofmipd'
under FreeBSD:

<blockquote><pre>
# pw groupadd tofmipd
# pw useradd tofmipd -g tofmipd -s /nonexistent

</blockquote></pre>

If you choose a name other than `tofmipd', make sure to start
tmda-ofmipd with the `-u' option.
</ol>

<h4>Starting tmda-ofmipd</h4>

<blockquote><pre>
$ tmda-ofmipd -d -f
tmda-ofmipd started at Mon Feb 3 13:55:37 MST 2003
        Listening on hrothgar.la.mastaler.com:8025

</blockquote></pre>
tmda-ofmipd is now listening in the foreground for
connections on port 8025 of your server.

<blockquote><pre>
$ telnet hrothgar 8025
Trying 128.165.147.60...
Connected to hrothgar.la.mastaler.com.
Escape character is '^]'.
220 hrothgar.la.mastaler.com ESMTP tmda-ofmipd
quit
221 Bye
Connection closed by foreign host.

</blockquote></pre>

The host:port combination can be changed using the `-p' option.  The `-d'
option prints debugging information to stderr which might be useful until
you get tmda-ofmipd working as you want it to. Leave off the `-f' option,
and tmda-ofmipd will detach and run in the background.

<hr>

<h2>MUA Configuration</h2>

You must now configure your MUA to use a port other than 25 to send
outgoing mail (by default, tmda-ofmipd runs on port 8025).
Configuring your mail client to use an alternate SMTP port to send
outgoing mail differs for every client, and is beyond to scope of this
document. However, see the following two links for examples of how to do this
for some of the more popular clients.
<br><br>

<li><a href="http://directory.purdue.edu/MAIL-HUB/md/smtp_auth.html" TARGET="Resource Window">
http://directory.purdue.edu/MAIL-HUB/md/smtp_auth.html</a><br>

<li><a href="http://independence.net/internet/port26.htm" TARGET="Resource Window">
http://independence.net/internet/port26.htm</a>
<br><br>

If your MUA only supports a sendmail interface for sending mail, see 
TMDA <a href="http://tmda.net/faq.cgi?req=all#5.7">FAQ 5.7</a>
for some options.

</td><!-- end of body cell -->
</tr><!-- end of sidebar/body row -->
</table><!-- end of page table -->
</body></html>
